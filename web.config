<?xml version="1.0" encoding="utf-8"?>
<!--
  AeroLMS - IIS Reverse Proxy Configuration

  This config makes IIS forward all traffic to Node.js running on localhost:3000

  Prerequisites:
  - URL Rewrite Module installed
  - Application Request Routing (ARR) installed
  - ARR Proxy enabled

  Node.js process (PM2):
  - Running on localhost:3000
  - Managed by PM2 (pm2 start ecosystem.config.js)
-->
<configuration>
  <system.webServer>

    <!-- URL Rewrite Rules -->
    <rewrite>
      <rules>
        <!-- Reverse proxy to Node.js on localhost:3000 -->
        <rule name="ReverseProxyToNodeJS" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{CACHE_URL}" pattern="^(.+)://" />
          </conditions>
          <action type="Rewrite" url="http://localhost:3000/{R:1}" />
        </rule>
      </rules>
    </rewrite>

    <!-- Security Headers -->
    <httpProtocol>
      <customHeaders>
        <!-- Prevent MIME type sniffing -->
        <add name="X-Content-Type-Options" value="nosniff" />

        <!-- Clickjacking protection -->
        <add name="X-Frame-Options" value="SAMEORIGIN" />

        <!-- Enable XSS filter -->
        <add name="X-XSS-Protection" value="1; mode=block" />

        <!-- Remove server header -->
        <remove name="X-Powered-By" />
      </customHeaders>
    </httpProtocol>

    <!-- Remove server signature -->
    <security>
      <requestFiltering removeServerHeader="true" />
    </security>

    <!-- Custom error pages (optional) -->
    <httpErrors errorMode="Detailed" existingResponse="PassThrough" />

  </system.webServer>

  <!--
    Optional: Application-level settings
    Uncomment if needed
  -->
  <!--
  <appSettings>
    <add key="NODE_ENV" value="production" />
  </appSettings>
  -->

</configuration>
